/***************************************************************************
 *     @file: tutubarão.c                                                  *
 *   @author: Gustavo Rosatto Silva                                        *
 * @objective: teste preliminares para um projeto envolvendo               *
 * eletrorrecepsção de tubarões / preliminary tests for a project          *
 * involving shark electroreception                                        *
 ***************************************************************************/

#include <stdio.h>
#include <stdlib.h>
#include <time.h>


// setando as variaveis / set the initial variables
const int altura = 23, largura = 80;

int posicao_tubarao_x = 1, posicao_tubarao_y = 1, posicao_peixe_x, posicao_peixe_y, x, y;

char chave_de_movimento_peixe;

//declaração de funções / funtion declaration
void cria_mapa(char mapa_oceano[altura][largura]){

    int count, i;

    //cria as bordas do mapa / start the boards of map
    for (y = 0; y < altura; ++y){

       for (x = 0; x < largura; ++x){

            if (x == 0 || x == largura - 1 || y == 0 || y == altura - 1){

               mapa_oceano[y][x] = 'H';

            }

            else{

                mapa_oceano[y][x] = ' ';

            }

       }

    }
    
    //cria obstaculos aleatório / create random obstacle
    srand(time(NULL));
    count = rand()%150;
    for (i = 0; i < count; ++i){
        mapa_oceano[(rand()%(altura-3)) + 1][(rand()%(largura-3)) + 1] = 'A';
    }

    //seta a posição inicial do tubarão / set the initial shark position
    mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] = '@';

    //seta a posição inicial do peixe / set the initial fish position
    posicao_peixe_x = (rand()%(largura-3)) + 1;
    
    posicao_peixe_y = (rand()%(altura-3)) + 1;
    
    mapa_oceano[posicao_peixe_y][posicao_peixe_x] = 'P';

}

char gerador_de_cordenada(char chave_de_movimento_peixe){
    
    int numero_aleatorio;


    numero_aleatorio = rand()%4;

    if (numero_aleatorio == 0){

        chave_de_movimento_peixe = 's';

    }

    if (numero_aleatorio == 1){

        chave_de_movimento_peixe = 'd';

    }

    if (numero_aleatorio == 2){

        chave_de_movimento_peixe = 'a';

    }

    if (numero_aleatorio == 3){

         chave_de_movimento_peixe = 'w';
                
    }

    return chave_de_movimento_peixe;

}

void imprime_mapa(char mapa_oceano[altura][largura]){
    for (y = 0; y < altura; ++y){

       for (x = 0; x < largura; ++x){

           printf("%c",mapa_oceano[y][x]);

       }

       printf("\n");

    }

}

char redefine_mapa_tubarao(char mapa_oceano[altura][largura], char auxiliar){
        if ((auxiliar == 'A' || auxiliar == 'a') && posicao_tubarao_x - 1 >= 1 && mapa_oceano[posicao_tubarao_y][posicao_tubarao_x -1] != 'A'){
            
            mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] = ' ';
            
            posicao_tubarao_x--;
            
            if (mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] == 'P'){
                auxiliar = 'k';
            }

            mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] = '@';
        }
    
        if ((auxiliar == 'W' || auxiliar == 'w') && posicao_tubarao_y - 1 >= 1 && mapa_oceano[posicao_tubarao_y - 1][posicao_tubarao_x] != 'A'){
            
            mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] = ' ';
            
            posicao_tubarao_y--;
            
            if (mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] == 'P'){
                auxiliar = 'k';
            }

            mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] = '@';
        }

        if ((auxiliar == 'S' || auxiliar == 's') && posicao_tubarao_y + 1 <= (altura -2) && mapa_oceano[posicao_tubarao_y + 1][posicao_tubarao_x] != 'A'){
            
            mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] = ' ';
            
            posicao_tubarao_y++;
            
            if (mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] == 'P'){
                auxiliar = 'k';
            }

            mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] = '@';
        }
    
        if ((auxiliar == 'D' || auxiliar == 'd') && posicao_tubarao_x + 1 <= (largura - 2) && mapa_oceano[posicao_tubarao_y][posicao_tubarao_x + 1] != 'A'){
            
            mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] = ' ';
            
            posicao_tubarao_x++;
            
            if (mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] == 'P'){
                auxiliar = 'k';
            }
            
            mapa_oceano[posicao_tubarao_y][posicao_tubarao_x] = '@';
        }

        system("clear");

        imprime_mapa(mapa_oceano);

        return auxiliar;

}

void redefine_mapa_peixe(char mapa_oceano[altura][largura], char auxiliar){
        
        if ((auxiliar == 'A' || auxiliar == 'a') && posicao_peixe_x - 1 >= 1 && mapa_oceano[posicao_peixe_y][posicao_peixe_x -1] != 'A'){
            
            mapa_oceano[posicao_peixe_y][posicao_peixe_x] = ' ';
            
            posicao_peixe_x--;
            
            if (mapa_oceano[posicao_tubarao_y][posicao_peixe_x] == '@'){
                
                auxiliar = 'k';
        
            }

            mapa_oceano[posicao_peixe_y][posicao_peixe_x] = 'P';
        
        }
    
        if ((auxiliar == 'W' || auxiliar == 'w') && posicao_peixe_y - 1 >= 1 && mapa_oceano[posicao_peixe_y - 1][posicao_peixe_x] != 'A'){
            
            mapa_oceano[posicao_peixe_y][posicao_peixe_x] = ' ';
            
            posicao_peixe_y--;
            
            if (mapa_oceano[posicao_peixe_y][posicao_peixe_x] == '@'){
                
                auxiliar = 'k';
        
            }

            mapa_oceano[posicao_peixe_y][posicao_peixe_x] = 'P';
        
        }

        if ((auxiliar == 'S' || auxiliar == 's') && posicao_peixe_y + 1 <= (altura -2) && mapa_oceano[posicao_peixe_y + 1][posicao_peixe_x] != 'A'){
            
            mapa_oceano[posicao_peixe_y][posicao_peixe_x] = ' ';
            
            posicao_peixe_y++;
            
            if (mapa_oceano[posicao_peixe_y][posicao_peixe_x] == '@'){
            
                auxiliar = 'k';
            
            }

            mapa_oceano[posicao_peixe_y][posicao_peixe_x] = 'P';
        
        }
    
        if ((auxiliar == 'D' || auxiliar == 'd') && posicao_peixe_x + 1 <= (largura - 2) && mapa_oceano[posicao_peixe_y][posicao_peixe_x + 1] != 'A'){
            
            mapa_oceano[posicao_peixe_y][posicao_peixe_x] = ' ';
            
            posicao_peixe_x++;
            
            if (mapa_oceano[posicao_peixe_y][posicao_peixe_x] == '@'){
                
                auxiliar = 'k';
            
            }
            
            mapa_oceano[posicao_peixe_y][posicao_peixe_x] = 'P';
        
        }

        system("clear");

        imprime_mapa(mapa_oceano);

}

int main(){

    // setando as variaveis / set the initial variables
    char mapa_oceano[altura][largura], auxiliar, chave_de_movimento_peixe;

    // preencheendo o mapa / contruct the map
    cria_mapa(mapa_oceano);

    //imprimindo o mapa / print the map
    imprime_mapa(mapa_oceano);

    //movimentando meu tubarão
    
    while(1==1){
        scanf("%c", &auxiliar);
        
        if (auxiliar == 'k'){
        
            break;
        
        }

        else{

            chave_de_movimento_peixe = gerador_de_cordenada(chave_de_movimento_peixe);

            redefine_mapa_peixe(mapa_oceano, chave_de_movimento_peixe);
            
            auxiliar = redefine_mapa_tubarao(mapa_oceano, auxiliar);

        }
        
        if (auxiliar == 'k'){
        
            printf("win\n");
        
            break;
        
        }

    }

    return 0;

}

         // próximos passos//

// melhorar a IA de movimentar o peixe
// impedir o peixe de sobrebor o tubarão
// documentar melhor o código
// impedir o peixe de chocar contrar os obstáculos e não se mexer
// criar uma IA para movimentar o tubarão
